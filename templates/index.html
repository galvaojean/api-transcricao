<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <title>Transcri√ß√£o Autom√°tica</title>
</head>
<body>
  <h1>üéôÔ∏è Transcri√ß√£o Autom√°tica</h1>
  <button id="btnStart">Iniciar Grava√ß√£o</button>
  <button id="btnStop" disabled>Parar Grava√ß√£o</button>
  <div id="status"></div>
  <textarea id="output" rows="10" cols="50" placeholder="A transcri√ß√£o aparecer√° aqui..."></textarea>
  <h2>Resumo:</h2><pre id="resumo"></pre>
  <h2>Insights:</h2><pre id="insights"></pre>

  <script>
    let recorder, chunks = [];
    const btnStart = document.getElementById("btnStart"),
          btnStop  = document.getElementById("btnStop"),
          status   = document.getElementById("status"),
          output   = document.getElementById("output"),
          resumoEl = document.getElementById("resumo"),
          insightsEl = document.getElementById("insights");

    btnStart.onclick = async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      recorder = new MediaRecorder(stream);
      recorder.ondataavailable = e => chunks.push(e.data);
      recorder.onstart = () => {
        status.textContent = "Gravando...";
        btnStart.disabled = true;
        btnStop.disabled = false;
      };
      recorder.start();
    };

    btnStop.onclick = () => {
      recorder.onstop = async () => {
        status.textContent = "Enviando para transcri√ß√£o...";
        const blob = new Blob(chunks, { type: "audio/webm" });
        chunks = [];
        const form = new FormData();
        form.append("audio", blob, "grava.webm");

        const resp = await fetch("/transcrever", { method: "POST", body: form });
        const data = await resp.json();
        if (resp.ok) {
          status.textContent = "‚úÖ Transcri√ß√£o conclu√≠da";
          output.value = data.transcricao;
          resumoEl.textContent = data.resumo;
          insightsEl.textContent = data.insights.join("\n‚Ä¢ ");
        } else {
          status.textContent = "‚ùå Erro: " + (data.erro || resp.statusText);
        }
        btnStart.disabled = false;
        btnStop.disabled = true;
      };
      recorder.stop();
    };
  </script>
</body>
</html>
