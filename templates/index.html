<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Transcri√ß√£o Autom√°tica</title>
  <style>
    body { font-family: Arial; background:#f7f7f7; text-align:center; padding:40px }
    .container { background:#fff; padding:30px; border-radius:8px; display:inline-block; box-shadow:0 2px 8px rgba(0,0,0,0.1) }
    h1 { margin-bottom:20px }
    button { padding:12px 24px; margin:0 8px; font-size:16px; border:none; border-radius:4px; cursor:pointer }
    button:disabled { opacity:0.5; cursor:default }
    #output { width:100%; height:120px; margin-top:16px }
    #summary, #insights { text-align:left; max-width:600px; margin:16px auto }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéôÔ∏è Transcri√ß√£o Autom√°tica</h1>
    <button id="startBtn">Iniciar Grava√ß√£o</button>
    <button id="stopBtn" disabled>Parar Grava√ß√£o</button>
    <p id="status"></p>
    <textarea id="output" placeholder="A transcri√ß√£o aparecer√° aqui..."></textarea>
    <h2>Resumo:</h2>
    <div id="summary"></div>
    <h2>Insights:</h2>
    <ul id="insights"></ul>
  </div>

  <script>
    let recorder, chunks;
    const startBtn = document.getElementById("startBtn");
    const stopBtn  = document.getElementById("stopBtn");
    const status   = document.getElementById("status");
    const output   = document.getElementById("output");
    const summary  = document.getElementById("summary");
    const insights = document.getElementById("insights");

    startBtn.onclick = async () => {
      // prepara UI
      output.value = "";
      summary.innerText = "";
      insights.innerHTML = "";
      status.innerText = "Gravando‚Ä¶";

      // pede permiss√£o e inicia grava√ß√£o
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      recorder = new MediaRecorder(stream);
      chunks = [];
      recorder.ondataavailable = e => chunks.push(e.data);
      recorder.onstop = sendAudioToServer;
      recorder.start();

      startBtn.disabled = true;
      stopBtn.disabled  = false;
    };

    stopBtn.onclick = () => {
      recorder.stop();
      startBtn.disabled = false;
      stopBtn.disabled  = true;
      status.innerText = "Processando √°udio‚Ä¶";
    };

    async function sendAudioToServer() {
      const blob = new Blob(chunks, { type: "audio/webm" });
      const form = new FormData();
      form.append("audio", blob, "reuniao.webm");

      try {
        const res = await fetch("/transcrever", { method:"POST", body: form });
        const json = await res.json();
        if (!res.ok) throw json;

        // preenche resultados
        output.value   = json.transcricao;
        summary.innerText = json.resumo;
        insights.innerHTML = json.insights.map(i => `<li>${i}</li>`).join("");
        status.innerText = "‚úÖ Transcri√ß√£o conclu√≠da";
      } catch (err) {
        status.innerText = "Erro: " + (err.erro || JSON.stringify(err));
      }
    }
  </script>
</body>
</html>
